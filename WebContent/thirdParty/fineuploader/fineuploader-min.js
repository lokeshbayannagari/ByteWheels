var qq=qq||{},qq=function(e){return{hide:function(){return e.style.display="none",this},attach:function(t,o){return e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent&&e.attachEvent("on"+t,o),function(){qq(e).detach(t,o)}},detach:function(t,o){return e.removeEventListener?e.removeEventListener(t,o,!1):e.attachEvent&&e.detachEvent("on"+t,o),this},contains:function(t){return e==t?!0:e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e))},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){return null!=t.opacity&&"string"!=typeof e.style.opacity&&"undefined"!=typeof e.filters&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t),this},hasClass:function(t){return RegExp("(^| )"+t+"( |$)").test(e.className)},addClass:function(t){return qq(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){return e.className=e.className.replace(RegExp("(^| )"+t+"( |$)")," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t){if(e.querySelectorAll)return e.querySelectorAll("."+t);for(var o=[],n=e.getElementsByTagName("*"),i=n.length,s=0;i>s;s++)qq(n[s]).hasClass(t)&&o.push(n[s]);return o},children:function(){for(var t=[],o=e.firstChild;o;)1==o.nodeType&&t.push(o),o=o.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return qq(e).setText("")}}};qq.log=function(e,t){window.console&&(t&&"info"!==t?window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e):window.console.log(e))},qq.isObject=function(e){return null!==e&&e&&"object"==typeof e&&e.constructor===Object},qq.extend=function(e,t,o){for(var n in t)t.hasOwnProperty(n)&&(o&&qq.isObject(t[n])?(void 0===e[n]&&(e[n]={}),qq.extend(e[n],t[n],!0)):e[n]=t[n])},qq.indexOf=function(e,t,o){if(e.indexOf)return e.indexOf(t,o);var o=o||0,n=e.length;for(0>o&&(o+=n);n>o;o++)if(o in e&&e[o]===t)return o;return-1},qq.getUniqueId=function(){var e=0;return function(){return e++}}(),qq.ie=function(){return-1!=navigator.userAgent.indexOf("MSIE")},qq.ie10=function(){return-1!=navigator.userAgent.indexOf("MSIE 10")},qq.safari=function(){return void 0!=navigator.vendor&&-1!=navigator.vendor.indexOf("Apple")},qq.chrome=function(){return void 0!=navigator.vendor&&-1!=navigator.vendor.indexOf("Google")},qq.firefox=function(){return-1!=navigator.userAgent.indexOf("Mozilla")&&void 0!=navigator.vendor&&""==navigator.vendor},qq.windows=function(){return"Win32"==navigator.platform},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=function(){var e=document.createElement("div");return function(t){return e.innerHTML=t,t=e.firstChild,e.removeChild(t),t}}(),qq.obj2url=function(e,t,o){var n=[],i="&",s=function(e,o){var i=t?/\[\]$/.test(t)?t:t+"["+o+"]":o;"undefined"!=i&&"undefined"!=o&&n.push("object"==typeof e?qq.obj2url(e,i,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(i)+"="+encodeURIComponent(e()):encodeURIComponent(i)+"="+encodeURIComponent(e))};if(!o&&t)i=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",n.push(t),n.push(qq.obj2url(e));else if("[object Array]"===Object.prototype.toString.call(e)&&"undefined"!=typeof e)for(var r=0,o=e.length;o>r;++r)s(e[r],r);else if("undefined"!=typeof e&&null!==e&&"object"==typeof e)for(r in e)s(e[r],r);else n.push(encodeURIComponent(t)+"="+encodeURIComponent(e));return t?n.join(i):n.join(i).replace(/^&/,"").replace(/%20/g,"+")},qq.DisposeSupport={_disposers:[],dispose:function(){for(var e;e=this._disposers.shift();)e()},addDisposer:function(e){this._disposers.push(e)},_attach:function(){this.addDisposer(qq(arguments[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))}},qq.UploadButton=function(e){this._options={element:null,multiple:!1,acceptFiles:null,name:"file",onChange:function(){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},qq.extend(this._options,e),qq.extend(this,qq.DisposeSupport),this._element=this._options.element,qq(this._element).css({position:"relative",overflow:"hidden",direction:"ltr"}),this._input=this._createInput()},qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&qq(this._input).remove(),qq(this._element).removeClass(this._options.focusClass),this._input=this._createInput()},_createInput:function(){var e=document.createElement("input");this._options.multiple&&e.setAttribute("multiple","multiple"),this._options.acceptFiles&&e.setAttribute("accept",this._options.acceptFiles),e.setAttribute("type","file"),e.setAttribute("name",this._options.name),qq(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),this._element.appendChild(e);var t=this;return this._attach(e,"change",function(){t._options.onChange(e)}),this._attach(e,"mouseover",function(){qq(t._element).addClass(t._options.hoverClass)}),this._attach(e,"mouseout",function(){qq(t._element).removeClass(t._options.hoverClass)}),this._attach(e,"focus",function(){qq(t._element).addClass(t._options.focusClass)}),this._attach(e,"blur",function(){qq(t._element).removeClass(t._options.focusClass)}),window.attachEvent&&e.setAttribute("tabIndex","-1"),e}},qq.FineUploaderBasic=function(e){this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{endpoint:"/server/upload",params:{},customHeaders:{},forceMultipart:!1,inputName:"qqfile"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,stopOnFirstInvalidFile:!0},callbacks:{onSubmit:function(){},onComplete:function(){},onCancel:function(){},onUpload:function(){},onProgress:function(){},onError:function(){},onAutoRetry:function(){},onManualRetry:function(){},onValidate:function(){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"}},qq.extend(this._options,e,!0),this._wrapCallbacks(),qq.extend(this,qq.DisposeSupport),this._filesInProgress=0,this._storedFileIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._handler=this._createUploadHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._preventLeaveInProgress()},qq.FineUploaderBasic.prototype={log:function(e,t){!this._options.debug||t&&"info"!==t?t&&"info"!==t&&qq.log("[FineUploader] "+e,t):qq.log("[FineUploader] "+e)},setParams:function(e){this._options.request.params=e},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){for(;this._storedFileIds.length;)this._filesInProgress++,this._handler.upload(this._storedFileIds.shift(),this._options.request.params)},clearStoredFiles:function(){this._storedFileIds=[]},retry:function(e){return this._onBeforeManualRetry(e)?(this._handler.retry(e),!0):!1},cancel:function(e){this._handler.cancel(e)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._filesInProgress=0,this._storedFileIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._button.reset()},_createUploadButton:function(e){var t=this,o=new qq.UploadButton({element:e,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),acceptFiles:this._options.validation.acceptFiles,onChange:function(e){t._onInputChange(e)}});return this.addDisposer(function(){o.dispose()}),o},_createUploadHandler:function(){var e,t=this;return e=qq.UploadHandlerXhr.isSupported()?"UploadHandlerXhr":"UploadHandlerForm",new qq[e]({debug:this._options.debug,endpoint:this._options.request.endpoint,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,demoMode:this._options.demoMode,log:this.log,onProgress:function(e,o,n,i){t._onProgress(e,o,n,i),t._options.callbacks.onProgress(e,o,n,i)},onComplete:function(e,o,n,i){t._onComplete(e,o,n,i),t._options.callbacks.onComplete(e,o,n)},onCancel:function(e,o){t._onCancel(e,o),t._options.callbacks.onCancel(e,o)},onUpload:function(e,o,n){t._onUpload(e,o,n),t._options.callbacks.onUpload(e,o,n)},onAutoRetry:function(e,o,n,i){return t._preventRetries[e]=n[t._options.retry.preventRetryResponseProperty],t._shouldAutoRetry(e,o,n)?(t._maybeParseAndSendUploadError(e,o,n,i),t._options.callbacks.onAutoRetry(e,o,t._autoRetries[e]+1),t._onBeforeAutoRetry(e,o),t._retryTimeouts[e]=setTimeout(function(){t._onAutoRetry(e,o,n)},1e3*t._options.retry.autoAttemptDelay),!0):!1}})},_preventLeaveInProgress:function(){var e=this;this._attach(window,"beforeunload",function(t){return e._filesInProgress?(t=t||window.event,t.returnValue=e._options.messages.onLeave):void 0})},_onSubmit:function(){this._options.autoUpload&&this._filesInProgress++},_onProgress:function(){},_onComplete:function(e,t,o,n){this._filesInProgress--,this._maybeParseAndSendUploadError(e,t,o,n)},_onCancel:function(e){clearTimeout(this._retryTimeouts[e]),e=qq.indexOf(this._storedFileIds,e),this._options.autoUpload||0>e?this._filesInProgress--:this._options.autoUpload||this._storedFileIds.splice(e,1)},_onUpload:function(){},_onInputChange:function(e){this._handler instanceof qq.UploadHandlerXhr?this._uploadFileList(e.files):this._validateFile(e)&&this._uploadFile(e),this._button.reset()},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onAutoRetry:function(e,t){this.log("Retrying "+t+"..."),this._autoRetries[e]++,this._handler.retry(e)},_shouldAutoRetry:function(e){return!this._preventRetries[e]&&this._options.retry.enableAuto?(void 0===this._autoRetries[e]&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts):!1},_onBeforeManualRetry:function(e){if(this._preventRetries[e])return this.log("Retries are forbidden for id "+e,"warn"),!1;if(this._handler.isValid(e)){var t=this._handler.getName(e);return!1===this._options.callbacks.onManualRetry(e,t)?!1:(this.log("Retrying upload for '"+t+"' (id: "+e+")..."),this._filesInProgress++,!0)}return this.log("'"+e+"' is not a valid file ID","error"),!1},_maybeParseAndSendUploadError:function(e,t,o,n){o.success||(n&&200!==n.status&&!o.error?this._options.callbacks.onError(e,t,"XHR returned response code "+n.status):this._options.callbacks.onError(e,t,o.error?o.error:"Upload failure reason unknown"))},_uploadFileList:function(e){var t,o;if(t=this._getValidationDescriptors(e),1<t.length&&(o=!1===this._options.callbacks.onValidate(t)),!o)if(0<e.length){for(t=0;t<e.length;t++)if(this._validateFile(e[t]))this._uploadFile(e[t]);else if(this._options.validation.stopOnFirstInvalidFile)break}else this._error("noFilesError","")},_uploadFile:function(e){var e=this._handler.add(e),t=this._handler.getName(e);!1!==this._options.callbacks.onSubmit(e,t)&&(this._onSubmit(e,t),this._options.autoUpload?this._handler.upload(e,this._options.request.params):this._storeFileForLater(e))},_storeFileForLater:function(e){this._storedFileIds.push(e)},_validateFile:function(e){var t,o,e=this._getValidationDescriptor(e);return t=e.name,o=e.size,!1===this._options.callbacks.onValidate([e])?!1:this._isAllowedExtension(t)?0===o?(this._error("emptyError",t),!1):o&&this._options.validation.sizeLimit&&o>this._options.validation.sizeLimit?(this._error("sizeError",t),!1):o&&o<this._options.validation.minSizeLimit?(this._error("minSizeError",t),!1):!0:(this._error("typeError",t),!1)},_error:function(e,t){var o=this._options.messages[e],n=this._options.validation.allowedExtensions.join(", "),i=this._formatFileName(t),o=o.replace("{file}",i),o=o.replace("{extensions}",n),n=this._formatSize(this._options.validation.sizeLimit),o=o.replace("{sizeLimit}",n),n=this._formatSize(this._options.validation.minSizeLimit),o=o.replace("{minSizeLimit}",n);return this._options.callbacks.onError(null,t,o),o},_formatFileName:function(e){return 33<e.length&&(e=e.slice(0,19)+"..."+e.slice(-13)),e},_isAllowedExtension:function(e){var e=-1!==e.indexOf(".")?e.replace(/.*[.]/,"").toLowerCase():"",t=this._options.validation.allowedExtensions;if(!t.length)return!0;for(var o=0;o<t.length;o++)if(t[o].toLowerCase()==e)return!0;return!1},_formatSize:function(e){var t=-1;do e/=1024,t++;while(e>99);return Math.max(e,.1).toFixed(1)+"kB MB GB TB PB EB".split(" ")[t]},_wrapCallbacks:function(){var e,t;e=this,t=function(t,o,n){try{return o.apply(e,n)}catch(i){e.log("Caught exception in '"+t+"' callback - "+i,"error")}};for(var o in this._options.callbacks)(function(){var n=e._options.callbacks[o];e._options.callbacks[o]=function(){return t(o,n,arguments)}})()},_parseFileName:function(e){return e.value?e.value.replace(/.*(\/|\\)/,""):null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name},_parseFileSize:function(e){var t;return e.value||(t=null!==e.fileSize&&void 0!==e.fileSize?e.fileSize:e.size),t},_getValidationDescriptor:function(e){var t,o;return o={},t=this._parseFileName(e),e=this._parseFileSize(e),o.name=t,e&&(o.size=e),o},_getValidationDescriptors:function(e){var t,o;for(o=[],t=0;t<e.length;t++)o.push(e[t]);return o}},qq.FineUploader=function(e){qq.FineUploaderBasic.apply(this,arguments),qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:!0,disableDefaultDropzone:!1},text:{uploadButton:"Upload a file",cancelButton:"Cancel",retryButton:"Retry",failUpload:"Upload failed",dragZone:"Drop files here to upload",formatProgress:"{percent}% of {total_size}",waitingForResponse:"Processing..."},template:'<div class="qq-uploader">'+(this._options.dragAndDrop&&this._options.dragAndDrop.disableDefaultDropzone?"":'<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>')+(this._options.button?"":'<div class="qq-upload-button"><div>{uploadButtonText}</div></div>')+(this._options.listElement?"":'<ul class="qq-upload-list"></ul>')+"</div>",fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><a class="qq-upload-retry" href="#">{retryButtonText}</a><span class="qq-upload-status-text">{statusText}</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",dropDisabled:"qq-upload-drop-area-disabled",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",retry:"qq-upload-retry",statusText:"qq-upload-status-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file"},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:!1},showMessage:function(e){alert(e)}},!0),qq.extend(this._options,e,!0),this._wrapCallbacks(),this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone),this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,""),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._bindCancelAndRetryEvents(),this._setupDragDrop()},qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype),qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments),this._listElement.innerHTML=""},addExtraDropzone:function(e){this._setupExtraDropzone(e)},removeExtraDropzone:function(e){var t,o=this._options.dragAndDrop.extraDropzones;for(t in o)if(o[t]===e)return this._options.dragAndDrop.extraDropzones.splice(t,1)},getItemByFileId:function(e){for(var t=this._listElement.firstChild;t;){if(t.qqFileId==e)return t;t=t.nextSibling}},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments),this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._options.button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._bindCancelAndRetryEvents(),this._setupDragDrop()},_leaving_document_out:function(e){return(qq.chrome()||qq.safari()&&qq.windows())&&0==e.clientX&&0==e.clientY||qq.firefox()&&!e.relatedTarget},_storeFileForLater:function(e){qq.FineUploaderBasic.prototype._storeFileForLater.apply(this,arguments);var t=this.getItemByFileId(e);qq(this._find(t,"spinner")).hide()},_find:function(e,t){var o=qq(e).getByClass(this._options.classes[t])[0];if(!o)throw Error("element not found "+t);return o},_setupExtraDropzone:function(e){this._options.dragAndDrop.extraDropzones.push(e),this._setupDropzone(e)},_setupDropzone:function(e){var t=this,o=new qq.UploadDropZone({element:e,onEnter:function(o){qq(e).addClass(t._classes.dropActive),o.stopPropagation()},onLeave:function(){},onLeaveNotDescendants:function(){qq(e).removeClass(t._classes.dropActive)},onDrop:function(o){t._options.dragAndDrop.hideDropzones&&qq(e).hide(),qq(e).removeClass(t._classes.dropActive),1<o.dataTransfer.files.length&&!t._options.multiple?t._error("tooManyFilesError",""):t._uploadFileList(o.dataTransfer.files)}});this.addDisposer(function(){o.dispose()}),this._options.dragAndDrop.hideDropzones&&qq(e).hide()},_setupDragDrop:function(){var e,t;e=this,this._options.dragAndDrop.disableDefaultDropzone||(t=this._find(this._element,"drop"),this._options.dragAndDrop.extraDropzones.push(t));var o,n=this._options.dragAndDrop.extraDropzones;for(o=0;o<n.length;o++)this._setupDropzone(n[o]);!this._options.dragAndDrop.disableDefaultDropzone&&(!qq.ie()||qq.ie10())&&this._attach(document,"dragenter",function(){if(!qq(t).hasClass(e._classes.dropDisabled))for(t.style.display="block",o=0;o<n.length;o++)n[o].style.display="block"}),this._attach(document,"dragleave",function(t){if(e._options.dragAndDrop.hideDropzones&&qq.FineUploader.prototype._leaving_document_out(t))for(o=0;o<n.length;o++)qq(n[o]).hide()}),qq(document).attach("drop",function(t){if(e._options.dragAndDrop.hideDropzones)for(o=0;o<n.length;o++)qq(n[o]).hide();t.preventDefault()})},_onSubmit:function(e,t){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onProgress:function(e,t,o,n){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var i,s,r,a;i=this.getItemByFileId(e),s=this._find(i,"progressBar"),a=Math.round(100*(o/n)),o===n?(r=this._find(i,"cancel"),qq(r).hide(),qq(s).hide(),qq(this._find(i,"statusText")).setText(this._options.text.waitingForResponse),r=this._formatSize(n)):(r=this._formatProgress(o,n),qq(s).css({display:"block"})),qq(s).css({width:a+"%"}),i=this._find(i,"size"),qq(i).css({display:"inline"}),qq(i).setText(r)},_onComplete:function(e,t,o,n){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var i=this.getItemByFileId(e);qq(this._find(i,"statusText")).clearText(),qq(i).removeClass(this._classes.retrying),qq(this._find(i,"progressBar")).hide(),(!this._options.disableCancelForFormUploads||qq.UploadHandlerXhr.isSupported())&&qq(this._find(i,"cancel")).hide(),qq(this._find(i,"spinner")).hide(),o.success?(qq(i).addClass(this._classes.success),this._classes.successIcon&&(this._find(i,"finished").style.display="inline-block",qq(i).addClass(this._classes.successIcon))):(qq(i).addClass(this._classes.fail),this._classes.failIcon&&(this._find(i,"finished").style.display="inline-block",qq(i).addClass(this._classes.failIcon)),this._options.retry.showButton&&!this._preventRetries[e]&&qq(i).addClass(this._classes.retryable),this._controlFailureTextDisplay(i,o))},_onUpload:function(e,t,o){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments),this._showSpinner(this.getItemByFileId(e))},_onBeforeAutoRetry:function(e){var t,o,n,i,s;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments),t=this.getItemByFileId(e),o=this._find(t,"progressBar"),this._showCancelLink(t),o.style.width=0,qq(o).hide(),this._options.retry.showAutoRetryNote&&(o=this._find(t,"statusText"),n=this._autoRetries[e]+1,i=this._options.retry.maxAutoAttempts,s=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,n),s=s.replace(/\{maxAuto\}/g,i),qq(o).setText(s),1===n&&qq(t).addClass(this._classes.retrying))},_onBeforeManualRetry:function(e){if(qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){var t=this.getItemByFileId(e);return this._find(t,"progressBar").style.width=0,qq(t).removeClass(this._classes.fail),this._showSpinner(t),this._showCancelLink(t),!0}return!1},_addToList:function(e,t){var o=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.UploadHandlerXhr.isSupported()){var n=this._find(o,"cancel");qq(n).remove()}o.qqFileId=e,n=this._find(o,"file"),qq(n).setText(this._formatFileName(t)),qq(this._find(o,"size")).hide(),this._options.multiple||this._clearList(),this._listElement.appendChild(o)},_clearList:function(){this._listElement.innerHTML="",this.clearStoredFiles()},_bindCancelAndRetryEvents:function(){var e=this;this._attach(this._listElement,"click",function(t){var t=t||window.event,o=t.target||t.srcElement;if(qq(o).hasClass(e._classes.cancel)||qq(o).hasClass(e._classes.retry)){for(qq.preventDefault(t),t=o.parentNode;void 0==t.qqFileId;)t=o=o.parentNode;qq(o).hasClass(e._classes.cancel)?(e.cancel(t.qqFileId),qq(t).remove()):(qq(t).removeClass(e._classes.retryable),e.retry(t.qqFileId))}})},_formatProgress:function(e,t){var o=this._options.text.formatProgress,n=Math.round(100*(e/t)),o=o.replace("{percent}",n),n=this._formatSize(t);return o=o.replace("{total_size}",n)},_controlFailureTextDisplay:function(e,t){var o,n,i,s;o=this._options.failedUploadTextDisplay.mode,n=this._options.failedUploadTextDisplay.maxChars,i=this._options.failedUploadTextDisplay.responseProperty,"custom"===o?((o=t[i])?o.length>n&&(s=o.substring(0,n)+"..."):(o=this._options.text.failUpload,this.log("'"+i+"' is not a valid property on the server response.","warn")),qq(this._find(e,"statusText")).setText(s||o),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(e,o)):"default"===o?qq(this._find(e,"statusText")).setText(this._options.text.failUpload):"none"!==o&&this.log("failedUploadTextDisplay.mode value of '"+o+"' is not valid","warn")},_showTooltip:function(e,t){e.title=t},_showSpinner:function(e){this._find(e,"spinner").style.display="inline-block"},_showCancelLink:function(e){(!this._options.disableCancelForFormUploads||qq.UploadHandlerXhr.isSupported())&&(this._find(e,"cancel").style.display="inline")},_error:function(e,t){this._options.showMessage(qq.FineUploaderBasic.prototype._error.apply(this,arguments))}}),qq.UploadDropZone=function(e){this._options={element:null,onEnter:function(){},onLeave:function(){},onLeaveNotDescendants:function(){},onDrop:function(){}},qq.extend(this._options,e),qq.extend(this,qq.DisposeSupport),this._element=this._options.element,this._disableDropOutside(),this._attachEvents()},qq.UploadDropZone.prototype={_dragover_should_be_canceled:function(){return qq.safari()||qq.firefox()&&qq.windows()},_disableDropOutside:function(){qq.UploadDropZone.dropOutsideDisabled||(this._dragover_should_be_canceled?qq(document).attach("dragover",function(e){e.preventDefault()}):qq(document).attach("dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),qq.UploadDropZone.dropOutsideDisabled=!0)},_attachEvents:function(){var e=this;e._attach(e._element,"dragover",function(t){if(e._isValidFileDrag(t)){var o=qq.ie()?null:t.dataTransfer.effectAllowed;t.dataTransfer.dropEffect="move"==o||"linkMove"==o?"move":"copy",t.stopPropagation(),t.preventDefault()}}),e._attach(e._element,"dragenter",function(t){e._isValidFileDrag(t)&&e._options.onEnter(t)}),e._attach(e._element,"dragleave",function(t){if(e._isValidFileDrag(t)){e._options.onLeave(t);var o=document.elementFromPoint(t.clientX,t.clientY);qq(this).contains(o)||e._options.onLeaveNotDescendants(t)}}),e._attach(e._element,"drop",function(t){e._isValidFileDrag(t)&&(t.preventDefault(),e._options.onDrop(t))})},_isValidFileDrag:function(e){if(qq.ie()&&!qq.ie10())return!1;var e=e.dataTransfer,t=qq.safari(),o=qq.ie10()?!0:"none"!=e.effectAllowed;return e&&o&&(e.files||!t&&e.types.contains&&e.types.contains("Files"))}},qq.UploadHandlerAbstract=function(e){this._options={debug:!1,endpoint:"/upload.php",maxConnections:999,log:function(){},onProgress:function(){},onComplete:function(){},onCancel:function(){},onUpload:function(){},onAutoRetry:function(){}},qq.extend(this._options,e),this._queue=[],this._params=[],this.log=this._options.log},qq.UploadHandlerAbstract.prototype={add:function(){},upload:function(e,t){var o=this._queue.push(e),n={};qq.extend(n,t),this._params[e]=n,o<=this._options.maxConnections&&this._upload(e,this._params[e])},retry:function(e){0<=qq.indexOf(this._queue,e)?this._upload(e,this._params[e]):this.upload(e,this._params[e])},cancel:function(e){this.log("Cancelling "+e),this._cancel(e),this._dequeue(e)},cancelAll:function(){for(var e=0;e<this._queue.length;e++)this._cancel(this._queue[e]);this._queue=[]},getName:function(){},getSize:function(){},getQueue:function(){return this._queue},reset:function(){this.log("Resetting upload handler"),this._queue=[],this._params=[]},_upload:function(){},_cancel:function(){},_dequeue:function(e){e=qq.indexOf(this._queue,e),this._queue.splice(e,1);var t=this._options.maxConnections;this._queue.length>=t&&t>e&&(e=this._queue[t-1],this._upload(e,this._params[e]))},isValid:function(){}},qq.UploadHandlerForm=function(e){qq.UploadHandlerAbstract.apply(this,arguments),this._inputs={},this._detach_load_events={}},qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerForm.prototype,{add:function(e){e.setAttribute("name",this._options.inputName);var t="qq-upload-handler-iframe"+qq.getUniqueId();return this._inputs[t]=e,e.parentNode&&qq(e).remove(),t},getName:function(e){return this._inputs[e].value.replace(/.*(\/|\\)/,"")},isValid:function(e){return void 0!==this._inputs[e]},reset:function(){qq.UploadHandlerAbstract.prototype.reset.apply(this,arguments),this._inputs={},this._detach_load_events={}},_cancel:function(e){this._options.onCancel(e,this.getName(e)),delete this._inputs[e],delete this._detach_load_events[e],(e=document.getElementById(e))&&(e.setAttribute("src","javascript:false;"),qq(e).remove())},_upload:function(e,t){this._options.onUpload(e,this.getName(e),!1);var o=this._inputs[e];if(!o)throw Error("file with passed id was not added, or already uploaded or cancelled");var n=this.getName(e);t[this._options.inputName]=n;var i=this._createIframe(e),s=this._createForm(i,t);s.appendChild(o);var r=this;return this._attachLoadEvent(i,function(){r.log("iframe loaded");var t=r._getIframeContentJSON(i);setTimeout(function(){r._detach_load_events[e](),delete r._detach_load_events[e],qq(i).remove()},1),(t.success||!r._options.onAutoRetry(e,n,t))&&(r._options.onComplete(e,n,t),r._dequeue(e))}),this.log("Sending upload request for "+e),s.submit(),qq(s).remove(),e},_attachLoadEvent:function(e,t){var o=this;this._detach_load_events[e.id]=qq(e).attach("load",function(){if(o.log("Received response for "+e.id),e.parentNode){try{if(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML)return}catch(n){o.log("Error when attempting to access iframe during handling of upload response ("+n+")","error")}t()}})},_getIframeContentJSON:function(a){try{var b=a.contentDocument?a.contentDocument:a.contentWindow.document,c,d=b.body.innerHTML;this.log("converting iframe's innerHTML to JSON"),this.log("innerHTML = "+d),d&&d.match(/^<pre/i)&&(d=b.body.firstChild.firstChild.nodeValue),c=eval("("+d+")")}catch(e){this.log("Error when attempting to parse form upload response ("+e+")","error"),c={success:!1}}return c},_createIframe:function(e){var t=qq.toElement('<iframe src="javascript:false;" name="'+e+'" />');return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t},_createForm:function(e,t){var o=qq.toElement('<form method="'+(this._options.demoMode?"GET":"POST")+'" enctype="multipart/form-data"></form>'),n=qq.obj2url(t,this._options.endpoint);return o.setAttribute("action",n),o.setAttribute("target",e.name),o.style.display="none",document.body.appendChild(o),o}}),qq.UploadHandlerXhr=function(e){qq.UploadHandlerAbstract.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},qq.UploadHandlerXhr.isSupported=function(){var e=document.createElement("input");return e.type="file","multiple"in e&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof(new XMLHttpRequest).upload},qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerXhr.prototype,{add:function(e){if(!(e instanceof File))throw Error("Passed obj in not a File (in qq.UploadHandlerXhr)");return this._files.push(e)-1},getName:function(e){return e=this._files[e],null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name},getSize:function(e){return e=this._files[e],null!=e.fileSize?e.fileSize:e.size},getLoaded:function(e){return this._loaded[e]||0},isValid:function(e){return void 0!==this._files[e]},reset:function(){qq.UploadHandlerAbstract.prototype.reset.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},_upload:function(e,t){this._options.onUpload(e,this.getName(e),!0);var o=this._files[e],n=this.getName(e);this.getSize(e),this._loaded[e]=0;var i=this._xhrs[e]=new XMLHttpRequest,s=this;i.upload.onprogress=function(t){t.lengthComputable&&(s._loaded[e]=t.loaded,s._options.onProgress(e,n,t.loaded,t.total))},i.onreadystatechange=function(){4==i.readyState&&s._onComplete(e,i)},t=t||{},t[this._options.inputName]=n;var r=qq.obj2url(t,this._options.endpoint);i.open(this._options.demoMode?"GET":"POST",r,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("X-File-Name",encodeURIComponent(n)),i.setRequestHeader("Cache-Control","no-cache"),this._options.forceMultipart?(r=new FormData,r.append(this._options.inputName,o),o=r):(i.setRequestHeader("Content-Type","application/octet-stream"),i.setRequestHeader("X-Mime-Type",o.type));for(key in this._options.customHeaders)i.setRequestHeader(key,this._options.customHeaders[key]);this.log("Sending upload request for "+e),i.send(o)},_onComplete:function(a,b){if(this._files[a]){var c=this.getName(a),d=this.getSize(a),e;this._options.onProgress(a,c,d,d),this.log("xhr - server response received for "+a),this.log("responseText = "+b.responseText);try{e="function"==typeof JSON.parse?JSON.parse(b.responseText):eval("("+b.responseText+")")}catch(f){this.log("Error when attempting to parse xhr response text ("+f+")","error"),e={}}(200===b.status&&e.success||!this._options.onAutoRetry(a,c,e,b))&&(this._options.onComplete(a,c,e,b),
this._xhrs[a]=null,this._dequeue(a))}},_cancel:function(e){this._options.onCancel(e,this.getName(e)),this._files[e]=null,this._xhrs[e]&&(this._xhrs[e].abort(),this._xhrs[e]=null)}}),function(e){var t,o,n,i,s,r,a,l,p,d;r=["uploaderType"],n=function(e){return e&&(e=l(e),a(e),t("basic"===s("uploaderType")?new qq.FineUploaderBasic(e):new qq.FineUploader(e))),o},i=function(e,t){var n=o.data("fineuploader");return t?(void 0===n&&(n={}),n[e]=t,o.data("fineuploader",n),void 0):void 0===n?null:n[e]},t=function(e){return i("uploader",e)},s=function(e,t){return i(e,t)},a=function(t){var n=t.callbacks={};e.each((new qq.FineUploaderBasic)._options.callbacks,function(e){var t,i;t=/^on(\w+)/.exec(e)[1],t=t.substring(0,1).toLowerCase()+t.substring(1),i=o,n[e]=function(){var e=Array.prototype.slice.call(arguments);return i.triggerHandler(t,e)}})},l=function(t,n){var i,a;return i=void 0===n?"basic"!==t.uploaderType?{element:o[0]}:{}:n,e.each(t,function(t,o){0<=e.inArray(t,r)?s(t,o):o instanceof e?i[t]=o[0]:e.isPlainObject(o)?(i[t]={},l(o,i[t])):e.isArray(o)?(a=[],e.each(o,function(t,o){o instanceof e?e.merge(a,o):a.push(o)}),i[t]=a):i[t]=o}),void 0===n?i:void 0},p=function(o){return"string"===e.type(o)&&!o.match(/^_/)&&void 0!==t()[o]},d=function(e){return t()[e].apply(t(),Array.prototype.slice.call(arguments,1))},e.fn.fineUploader=function(i){return o=this,t()&&p(i)?d.apply(this,arguments):"object"!=typeof i&&i?(e.error("Method "+i+" does not exist on jQuery.fineUploader"),this):n.apply(this,arguments)}}(jQuery);